if (self.CavalryLogger) { CavalryLogger.start_js(["crFFg"]); }

__d("LiveVideoBroadcastAPIGoLiveButton.react",["ix","cx","fbt","AsyncRequest","AsyncResponse","ComposerEntryPointRef","FBConfirmDialog.react","Image.react","LiveVideoBroadcastActions","LiveVideoBroadcastAfterBootloadUtils","LiveVideoBroadcastAPIActions","LiveVideoBroadcastConstants","LiveVideoBroadcastCopyrightUtils","LiveVideoBroadcastStatusUpdateSubscriptionHack","LiveVideoBroadcastUIStore","LiveVideoCrosspostingConfig","React","ReactComposerStatusStore","ReactDOM","ScheduleLiveVideoDialog.react","ShareModeConst","Tooltip","VideoBroadcastStatus","XLiveVideoCheckIsPublishedController","XUIButton.react","XUIText.react","asset","expectationViolation","fbglyph","gkx"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k=b("LiveVideoCrosspostingConfig").maxCrossposts,l=b("LiveVideoBroadcastConstants").BROADCAST_STATE,m=b("LiveVideoBroadcastConstants").INPUT_SOURCE,n=b("LiveVideoBroadcastConstants").ENCODER_TYPE,o=2e3;c=babelHelpers.inherits(a,b("React").Component);j=c&&c.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=j.constructor).call.apply(a,[this].concat(e)),this.state={showManualModeConfirmDialog:!1},this.$15=function(a,c,d,e,f,g){__p&&__p();var h=function(){if(!this.props.actorID){b("expectationViolation")("cannot start broadcast without an actorID");return}b("LiveVideoBroadcastActions").scheduledLiveRequest(this.props.actorID,this.props.apiBroadcastID,a,c,d,e,f,g,!1)}.bind(this),i={video_broadcast_status:b("VideoBroadcastStatus").SCHEDULED_PREVIEW,is_continuous:this.props.isContinuous,is_embeddable:this.props.isEmbeddable,should_expire_after_live:this.props.shouldExpireAfterGoLive,should_show_graphic_content_warning:this.props.shouldShowGraphicContentWarning,is_rewind_enabled:this.props.isRewindEnabled,live_comment_moderation_setting:this.props.commentModes,crosspost_page_ids:this.props.crosspostingConfig.filter(function(a){return a.allow}).map(function(a){return a.id})};this.props.episodeData&&(i=babelHelpers["extends"]({},i,{is_episode:this.props.episodeData.isEpisode,season_id:this.props.episodeData.seasonID,playlist_ids:this.props.episodeData.playlistIDs}));this.props.canEnableLiveCoverVideo&&(i=babelHelpers["extends"]({},i,{is_page_live_cover_video_enabled:this.props.isLiveCoverVideoEnabled,is_page_live_cover_video_explicitly_set:!0}));b("LiveVideoBroadcastActions").prepareBroadcastForScheduledLive();b("LiveVideoBroadcastAfterBootloadUtils").updateBroadcastRequest(this.props.accessToken,this.props.actorID,this.props.apiVideoID,this.props.apiBroadcastID,this.props.composerConfig,this.props.copyrightData,this.props.targetID,this.props.isCopyrighted,this.props.metadataConfig,i,h,function(a,c){b("LiveVideoBroadcastActions").scheduledLiveFail(c&&c.$16)})}.bind(this),this.$4=function(){var a=b("ReactComposerStatusStore").getEditorState(this.props.composerConfig.contextConfig.composerID);a=a?a.getCurrentContent().getPlainText():"";var c=this.props.scheduleStartTime?new Date(this.props.scheduleStartTime*1e3):undefined;a=b("React").createElement(b("ScheduleLiveVideoDialog.react"),{broadcastID:this.props.apiBroadcastID,canAddLiveAnnouncementThumbnail:this.props.isShowPage&&this.props.episodeData&&this.props.episodeData.isEpisode,description:a,initialPublishDate:c,isPageTarget:this.props.shareMode===b("ShareModeConst").PAGE,previewTitle:this.props.previewTitle,targetID:this.props.targetID,timezoneStr:this.props.timezoneString?this.props.timezoneString:"",useComposerV2:this.props.useComposerV2,onSubmit:this.$15});a=b("ReactDOM").render(a,b("ReactDOM").findDOMNode(this.refs.scheduleDialogPlaceholder));a.show instanceof Function&&a.show()}.bind(this),this.$8=function(){this.setState({showManualModeConfirmDialog:!0})}.bind(this),this.$6=function(){this.setState({showManualModeConfirmDialog:!1})}.bind(this),this.$7=function(){this.setState({showManualModeConfirmDialog:!1});if(!this.props.actorID){b("expectationViolation")("cannot update broadcast without an actorID");return}b("LiveVideoBroadcastActions").scheduledLiveRequest(this.props.actorID,this.props.apiBroadcastID,null,null,null,null,null,null,!0)}.bind(this),this.$9=function(){__p&&__p();b("LiveVideoBroadcastAPIActions").apiGoLiveClicked();b("LiveVideoBroadcastStatusUpdateSubscriptionHack").subscribe(this.props.apiVideoID,function(a){a=a.live_video_broadcast_status_update_subscribe;a=a.video_broadcast_status;a===b("VideoBroadcastStatus").LIVE_STOPPED&&b("LiveVideoBroadcastAPIActions").apiBroadcastStopped()});b("LiveVideoBroadcastCopyrightUtils").subscribeToCopyrightEvents(this.props.apiBroadcastID);var a={attribution_app_id:this.props.attributionAppID||null,video_broadcast_status:b("gkx")("AT6Ymh1mCN0OUwHzYnk8uYM2foaoRl3zFkQMMoe-rnVDqlYA1Yr4jFXxFaUOagBakVXG_c5UYiPWSxCfsZr2Aol8")?b("VideoBroadcastStatus").PRE_LIVE:b("VideoBroadcastStatus").LIVE,is_continuous:this.props.isContinuous,is_embeddable:this.props.isEmbeddable,should_expire_after_live:this.props.shouldExpireAfterGoLive,should_show_graphic_content_warning:this.props.shouldShowGraphicContentWarning,is_rewind_enabled:this.props.isRewindEnabled,crosspost_page_ids:this.props.crosspostingConfig.filter(function(a){return a.allow}).map(function(a){return a.id}),live_comment_moderation_setting:this.props.commentModes};this.props.episodeData&&(a=babelHelpers["extends"]({},a,{is_episode:this.props.episodeData.isEpisode,season_id:this.props.episodeData.seasonID,playlist_ids:this.props.episodeData.playlistIDs}));this.props.canEnableLiveCoverVideo&&(a=babelHelpers["extends"]({},a,{is_page_live_cover_video_enabled:this.props.isLiveCoverVideoEnabled,is_page_live_cover_video_explicitly_set:!0}));b("LiveVideoBroadcastAfterBootloadUtils").updateBroadcastRequest(this.props.accessToken,this.props.actorID,this.props.apiVideoID,this.props.apiBroadcastID,this.props.composerConfig,this.props.copyrightData,this.props.targetID,this.props.isCopyrighted,this.props.metadataConfig,a,function(){this.props.selectedEncoderType===n.PAIRED_ENCODER?setTimeout(function(){return this.$17()}.bind(this),1e3):b("LiveVideoBroadcastActions").startLiveBroadcastSuccess()}.bind(this),function(){return b("LiveVideoBroadcastAPIActions").errorStartingAPIBroadcast("update endpoint")})}.bind(this),c}a.prototype.$1=function(){if(this.$2()||!this.props.showScheduleButton)return null;var a=this.props.inputSource===m.EDIT_SCHEDULE?i._("Edit Schedule"):i._("Schedule");return b("React").createElement(b("XUIButton.react"),{className:"_227w"+(this.props.showGoLiveButton?" _273n":"")+(this.props.showGoLiveButton?"":" _66d8"),disabled:this.$3(),image:b("React").createElement(b("Image.react"),{src:g("113033")}),label:a,use:"default",onClick:this.$4})};a.prototype.$5=function(){if(!this.state.showManualModeConfirmDialog)return null;var a=i._("Manually Start This Live Video?"),c=b("React").createElement("div",{className:"_3-8w _3-96"},b("React").createElement(b("XUIText.react"),{className:"_3-96",display:"block"},i._("You can decide when you want to publish this broadcast manually. This action can't be undone and you won't be able to schedule this live video again.")),b("React").createElement(b("XUIText.react"),{className:"_3-96",display:"block"},i._("To start your live video manually, click \"OK\" here then use the \"Go Live\" button")));return b("React").createElement(b("FBConfirmDialog.react"),{cancelButtonText:i._("Cancel"),confirmButtonText:i._("OK"),content:c,shown:!0,title:a,onCancel:this.$6,onConfirm:this.$7})};a.prototype.render=function(){var a=this.props.inputSource===m.EDIT_SCHEDULE&&!this.props.isScheduledManualMode,c=this.props.additionalButtons==null,d=c?b("React").createElement(b("Image.react"),{src:g("570643")}):b("React").createElement(b("Image.react"),{src:g("483315")}),e=a?this.$8:this.$9,f=a?i._("Manual Start"):i._("Go Live"),h=a?undefined:b("Tooltip").propsFor(i._("Add a title for your broadcast and check that your stream is connected before you go live."));a=a?this.$10():this.$11();return b("React").createElement("div",null,b("React").createElement("div",{ref:"scheduleDialogPlaceholder"}),this.$5(),b("React").createElement("div",{className:this.props.showGoLiveButton?"_eg3":""},this.$1(),this.props.showGoLiveButton?b("React").createElement("span",h,b("React").createElement(b("XUIButton.react"),{className:"_227w _273n _3-9a","data-testid":"go-live-button",disabled:a,image:d,label:f,use:c?"confirm":undefined,onClick:e})):null,this.props.additionalButtons))};a.prototype.$10=function(){return!this.props.apiBroadcastID||!this.props.actorID||this.props.isScheduledLiveRequestPending};a.prototype.$11=function(){return!this.props.apiLivePreviewPlaying||!this.props.apiBroadcastID||!this.props.actorID||this.props.isScheduledLiveRequestPending||this.$12()||this.$13()||this.$14()||this.props.isUpdateRequestPending||this.props.crosspostingConfig.reduce(function(a,b){return b.allow?a+1:a},0)>k};a.prototype.$3=function(){return!this.props.apiBroadcastID||!this.props.actorID||this.props.isScheduledLiveRequestPending||this.$12()||this.$13()||this.props.isUpdateRequestPending};a.prototype.$12=function(){return this.props.isShowPage&&(!this.props.metadataConfig.videoTitle||!this.props.episodeData||this.props.episodeData.isEpisode==null)};a.prototype.$14=function(){return!b("gkx")("AT5e547RuodJr5vSbkSq6zltMqS3wKEBjggYTKNE6hWWVfeRPS8qsei0HYpmnI6EXdqcdaBCTc19jRd85wCRCYNl")?!1:!this.props.metadataConfig.videoTitle};a.prototype.$13=function(){return this.props.isCopyrighted&&!this.props.copyrightData.selectedCategory};a.prototype.$2=function(){return this.props.composerConfig.contextConfig&&this.props.composerConfig.contextConfig.composerType===b("ComposerEntryPointRef").SOCIAL_PLUGIN};a.prototype.$17=function(){__p&&__p();var a=this.props.apiBroadcastID;a=b("XLiveVideoCheckIsPublishedController").getURIBuilder().setFBID("broadcast_id",a).setBool("end_if_unpublished",!1).getURI();var c=function(a){var c=b("LiveVideoBroadcastUIStore").getState().toObject();c=c.broadcastState;if(c===l.FINISHED)return;c=a.payload;c.is_published?(b("LiveVideoBroadcastActions").setStartTime(Date.now()),b("LiveVideoBroadcastActions").startLiveBroadcastSuccess()):setTimeout(function(){this.$17()}.bind(this),o)}.bind(this);new(b("AsyncRequest"))().setURI(a).setHandler(function(a){return c(a)}).send()};e.exports=a}),null);