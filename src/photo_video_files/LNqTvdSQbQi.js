if (self.CavalryLogger) { CavalryLogger.start_js(["IcSxS"]); }

__d("MercuryAttachmentPhoto.react",["ChatImageArrowDirection","ChatImageWithArrow.react","MercuryAttachmentViewer","MercuryIDs","MessagesViewerSetID","MessengerMessage.bs","React","SphericalPhotoUtils","SpotlightMercurySharedMediaViewer.react","URI","getPageIDFromThreadID"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=b("SphericalPhotoUtils").getThumbnailsFromPhotoEncodings;c=b("React").PropTypes;var i=160;d=babelHelpers.inherits(a,b("React").Component);g=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=g.constructor).call.apply(a,[this].concat(e)),this.state={newSharedPhotosView:!1},this.$1=function(a){__p&&__p();var c;a=this.props.image;var d=!0;!this.props.hasAttribution&&this.props.count&&(d=this.props.count===1);var e=this.props.message;e=e.thread_fbid?e.thread_fbid:b("MercuryIDs").getThreadFBIDFromThreadID(e.thread_id);e=new(b("URI"))("/ajax/messaging/attachments/sharedphotos.php").setQueryData({thread_id:e,image_id:a.metadata.fbid});var f=b("MessagesViewerSetID").MESSAGES_VIEW_ALL_IN_THREAD;c=(c=a.large_preview_url)!=null?c:a.preview_url;b("MercuryAttachmentViewer").bootstrapWithConfig({dimensions:a.metadata.dimensions,disablePaging:d,endpoint:e,fbid:a.metadata.fbid,setID:f,src:c},null)}.bind(this),this.$2=function(){var a=this.props.image;a&&a.metadata&&this.setState({newSharedPhotosView:a.metadata.fbid})}.bind(this),this.$3=function(){this.setState({newSharedPhotosView:null})}.bind(this),c}a.prototype.componentDidMount=function(){b("MercuryAttachmentViewer").preload(),this.props.onAttachmentLoad&&this.props.onAttachmentLoad(this.props.height)};a.prototype.$4=function(){var a=this.props.message.thread_fbid||this.props.message.thread_id&&b("MercuryIDs").getThreadFBIDFromThreadID(this.props.message.thread_id);return b("React").createElement(b("SpotlightMercurySharedMediaViewer.react"),{onClosePhotoView:this.$3,photoID:String(this.state.newSharedPhotosView),rootClassName:"",threadID:a,disableForward:!1,enableShareToFB:!0})};a.prototype.render=function(){var a=b("MessengerMessage.bs").isInbound(this.props.message),c=!!b("getPageIDFromThreadID")(this.props.message.thread_id);c=!this.props.hasAttribution&&!c?this.$2:this.$1;var d=this.state.newSharedPhotosView?this.$4():null,e=this.props.photoEncodings?this.props.photoEncodings.length!==0:!1,f=this.props.image.preview_url;if(e){var g=h(this.props.photoEncodings);g=g.smallThumbnail;f=g||this.props.image.preview_url}return b("React").createElement("div",{onFocus:this.$5},d,b("React").createElement(b("ChatImageWithArrow.react"),{arrowDirection:a?b("ChatImageArrowDirection").LEFT:b("ChatImageArrowDirection").RIGHT,source:f,height:e?i:this.props.height,width:e?i:this.props.width,onClick:c,round:!!this.props.round,isLoading:!!this.props.image.preview_uploading,isSpherical:e}))};a.prototype.$5=function(event){event.stopPropagation()};a.propTypes={hasAttribution:c.bool,height:c.number,image:c.object.isRequired,photoEncodings:c.array,message:c.object.isRequired,onAttachmentLoad:c.func,round:c.bool,width:c.number};e.exports=a}),null);