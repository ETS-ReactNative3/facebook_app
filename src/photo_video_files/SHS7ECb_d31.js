if (self.CavalryLogger) { CavalryLogger.start_js(["ufZrW"]); }

__d("P2PProductItemChatThreadBanner.react",["cx","fbt","ix","AsyncRequest","BackgroundImage.react","ContextualLayerAutoFlip","CurrentUser","Image.react","Layout.react","LineClamp.react","Link.react","MercuryIDs","MessengerState.bs","P2PActions","P2PAPI","P2PGKValues","P2PLogger","P2PLinkConstants","P2PMessageSellerConfirmationDialog.react","P2PPaymentLoggerEvent","P2PPaymentLoggerEventFlow","P2PPlatformContextShape","P2PPlatformContextStore","P2PUserEligibilityStore","PopoverMenu.react","ReactComponentWithPureRenderMixin","React","ReactLayeredComponentMixin_DEPRECATED","ReactXUIMenu","StoreAndPropBasedStateMixin","Tooltip.react","XC2CPayNUXBannerImpressionsUpdateController","XGroupsReportToAdminController","XUIAmbientNUX.react","XUIButton.react","XUIGrayText.react"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=b("Layout.react").Column,k=b("Layout.react").FillColumn,l=b("ReactXUIMenu").Item,m=!1,n=new Set();a=b("React").createClass({displayName:"P2PProductItemChatThreadBanner",mixins:[b("ReactLayeredComponentMixin_DEPRECATED"),b("ReactComponentWithPureRenderMixin"),b("StoreAndPropBasedStateMixin")(b("P2PUserEligibilityStore"))],propTypes:{platformContext:b("P2PPlatformContextShape").isRequired},getInitialState:function(){return{requestEnabled:b("P2PGKValues").P2PGroupCommerceRequestEnabled,showConfirmationDialog:!1,showNUX:!1}},statics:{calculateState:function(a){return{canSendToRecipient:b("P2PUserEligibilityStore").getEligibilityByThreadID(b("P2PPlatformContextStore").getThreadIDFromPlatformContext(a.platformContext))}}},componentDidMount:function(){var a=this.props.platformContext,c=b("P2PPlatformContextStore").getThreadIDFromPlatformContext(a);this.handleShouldShowPayNUX();n.has(c)||(n.add(c),b("P2PPlatformContextStore").isViewerSellerForPlatformContext(a)?this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_SELLER_VIEWED):this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_BUYER_VIEWED))},componentDidUpdate:function(a,b){!b.canSendToRecipient&&this.state.canSendToRecipient&&this.handleShouldShowPayNUX()},log:function(a,c){var d={platform_logging_data:this.props.platformContext.product.loggingData};b("P2PLogger").log(a,babelHelpers["extends"]({www_event_flow:b("P2PPaymentLoggerEventFlow").UI_FLOW_PLATFORM_BANNER},d,c))},handleShouldShowPayNUX:function(){var a=this.props.platformContext;a=!m&&this.shouldRenderPayButton()&&a.banner.shouldShowPayNux;a&&(this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_PAY_NUX_SHOWN),m=!0,this.setState({showNUX:!0}),new(b("AsyncRequest"))().setURI(b("XC2CPayNUXBannerImpressionsUpdateController").getURIBuilder().getURI()).setMethod("POST").send())},handleDismissClick:function(a){a.preventDefault();a=this.props.platformContext;b("P2PAPI").dismissPlatformContextBanner(a.id);b("P2PPlatformContextStore").isViewerSellerForPlatformContext(a)?this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_SELLER_HIDE_CLICKED):this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_BUYER_HIDE_CLICKED)},handleSoldClick:function(a){a.preventDefault(),b("P2PAPI").markSoldPlatformContextProductItem(this.props.platformContext.id),this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_SOLD_CLICKED)},handleRequestClick:function(a){a.preventDefault(),this.openSendMoneyFlyoutRequestTab(),this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_REQUEST_CLICKED)},hasNoMessagesFromSeller:function(){var a=this.props.platformContext,c=b("P2PPlatformContextStore").getThreadIDFromPlatformContext(a);c=b("MessengerState.bs").getCurrentlyLoadedMessages(b("CurrentUser").getID(),c);if(!c)return!0;var d=b("MercuryIDs").getParticipantIDFromUserID(a.sellerID);a=c.some(function(a){return a.author===d});return!a},handlePayClick:function(a){a.preventDefault(),this.hasNoMessagesFromSeller()?(this.setState({showConfirmationDialog:!0}),this.log(b("P2PPaymentLoggerEvent").UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_SHOWN)):this.openSendMoneyFlyout()},openSendMoneyFlyoutRequestTab:function(){var a=this.props.platformContext,c=a.product,d=b("P2PPlatformContextStore").getThreadIDFromPlatformContext(a);b("P2PActions").chatSendViewOpened({amount:c.formattedAmount,memoText:c.name,openRequestTab:!0,platformData:{platformContextID:a.id,loggingData:c.loggingData},threadID:d})},openSendMoneyFlyout:function(){var a=this.props.platformContext,c=a.product,d=b("P2PPlatformContextStore").getThreadIDFromPlatformContext(a);b("P2PActions").chatSendViewOpened({threadID:d,amount:c.formattedAmount,platformData:{platformContextID:a.id,loggingData:c.loggingData}});this.setState({showNUX:!1});this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_PAY_CLICKED)},handleImageClicked:function(){this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_IMAGE_CLICKED)},handleTitleClicked:function(){this.log(b("P2PPaymentLoggerEvent").UI_ACTN_PLATFORM_BANNER_TITLE_CLICKED)},renderMarkSold:function(){var a=this.props.platformContext,c;if(!a.product.isAvailable)return null;b("P2PPlatformContextStore").isViewerSellerForPlatformContext(a)&&(c=b("React").createElement(b("Link.react"),{href:"#",onClick:this.handleSoldClick},h._("Mark Sold")));return c},renderPayButton:function(){if(!this.shouldRenderPayButton())return null;var a=b("React").createElement(b("XUIButton.react"),{label:h._("Pay"),onClick:this.handlePayClick,ref:"pay_button",use:"confirm"});this.state.showNUX||(a=b("React").createElement(b("Tooltip.react"),{alignH:"right",display:"block",tooltip:h._("You can confirm the amount next.")},a));return b("React").createElement("div",{className:this.isCompactMode()?"":"_3-8x"},a)},renderRequestButton:function(){return!this.shouldRenderRequestButton()?null:b("React").createElement(b("Link.react"),{className:"_f-n",href:"#",onClick:this.handleRequestClick},h._("Request Payment"))},shouldRenderPayButton:function(){var a=this.props.platformContext,c=b("P2PPlatformContextStore").isViewerBuyerForPlatformContext(this.props.platformContext);return!!(this.state.canSendToRecipient&&a.product.isAvailable&&c&&a.product.rawAmount.amount>0)},shouldRenderSellerActionsRow:function(){var a=this.props.platformContext,c=b("P2PPlatformContextStore").isViewerSellerForPlatformContext(a);return c&&a.product.isAvailable},shouldRenderRequestButton:function(){return!!(this.state.requestEnabled&&this.state.canSendToRecipient&&this.props.platformContext.product.rawAmount.amount>0)},getAmountText:function(){var a=this.props.platformContext;a=a.product;return a.rawAmount.amount>0?a.formattedAmount:h._("FREE")},renderAskingPriceRow:function(){var a=this.props.platformContext;a=a.product;if(a.isAvailable)return b("React").createElement(b("LineClamp.react"),{lines:1,lineHeight:16},b("React").createElement(b("XUIGrayText.react"),{shade:"light"},h._("Price: {price of the item}",[h._param("price of the item",this.getAmountText())])))},renderNameLine:function(){var a=this.props.platformContext;a=a.product;var c="dark",d;a.isAvailable||(c="light",d=h._("SOLD"));return b("React").createElement(b("Link.react"),{href:a.refURL||"#",onClick:this.handleTitleClicked},b("React").createElement(b("XUIGrayText.react"),{shade:c},d?"("+d+") ":null,a.name))},renderSellerActionsRow:function(){return!this.shouldRenderSellerActionsRow()?null:b("React").createElement("div",{className:"_f-o"},this.renderMarkSold(),this.renderRequestButton())},renderImageColumn:function(){var a=this.props.platformContext;a=a.product;return this.isCompactMode()?null:b("React").createElement(j,{className:"_3-90"},b("React").createElement("div",{className:"_5qnr"},b("React").createElement("div",{className:"_5qn-"},b("React").createElement(b("Link.react"),{href:a.refURL||"#",onClick:this.handleImageClicked},b("React").createElement(b("BackgroundImage.react"),{backgroundPosition:"50% 50%",backgroundSize:"cover",height:45,src:a.image,width:45})))))},renderPopoverMenu:function(){var a=this.props.platformContext;a=a.product;a=b("XGroupsReportToAdminController").getURIBuilder().setFBID("post_id",a.loggingData.post_id).getURI();a=b("React").createElement(b("ReactXUIMenu"),{className:"_1z1u"},b("React").createElement(l,{className:"_1z1_"},b("React").createElement("div",{onClick:this.handleDismissClick,role:"presentation"},h._("Hide from conversation"))),b("React").createElement(l,{ajaxify:a,rel:"async-post"},h._("Report to admin")),b("React").createElement(l,{href:b("P2PLinkConstants").helpCenterURI,target:"_blank"},h._("Learn more")));return b("React").createElement(b("PopoverMenu.react"),{alignh:"right",layerBehaviors:[b("ContextualLayerAutoFlip")],menu:a,className:"_3fqa"},b("React").createElement("div",{className:"_1z20"},b("React").createElement(b("Link.react"),{className:"_1z21",href:"#"})))},isCompactMode:function(){var a=this.props.platformContext;a=a.product;return!a.image||!a.isAvailable},onNUXCloseButtonClick:function(){this.setState({showNUX:!1})},renderLayers:function(){var a={};this.state.showNUX?a.ambientNUX=b("React").createElement(b("XUIAmbientNUX.react"),{alignment:"left",contextRef:function(){return this.refs.pay_button}.bind(this),customwidth:234,onCloseButtonClick:this.onNUXCloseButtonClick,position:"above",shown:!0,width:"custom"},b("React").createElement("div",{className:"_3-95"},h._("You can pay for this item right from your messages.")),b("React").createElement("div",null,b("React").createElement(b("Image.react"),{className:"_3fqb",height:14,src:i("94455"),width:10}),b("React").createElement("span",{className:"_3fqc"},h._("It's free and secure.")))):this.state.showConfirmationDialog&&(a.confirmationDialog=b("React").createElement(b("P2PMessageSellerConfirmationDialog.react"),{onCancel:function(){this.setState({showConfirmationDialog:!1}),this.log(b("P2PPaymentLoggerEvent").UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_CANCEL_CLICK)}.bind(this),onPay:function(){this.setState({showConfirmationDialog:!1}),this.openSendMoneyFlyout(),this.log(b("P2PPaymentLoggerEvent").UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_PAY_CLICK)}.bind(this)}));return a},render:function(){return b("React").createElement("div",{className:"_319c"+(this.isCompactMode()?" _5qn_":"")},b("React").createElement(b("Layout.react"),null,this.renderImageColumn(),b("React").createElement(k,null,b("React").createElement("div",{className:"_5qo0"},b("React").createElement("div",{className:"_5qo1"},b("React").createElement(b("LineClamp.react"),{lines:1,lineHeight:16},this.renderNameLine()),this.renderAskingPriceRow(),this.renderSellerActionsRow()))),b("React").createElement(j,null,b("React").createElement("div",{className:"_1_68"},this.renderPopoverMenu(),this.renderPayButton()))))}});e.exports=a}),null);