if (self.CavalryLogger) { CavalryLogger.start_js(["tuGaH"]); }

__d("ReactComposerLiveBroadcastPreviewVideoPlayer.react",["cx","fbt","CenteredContainer.react","ComposerEntryPointRef","CreateBroadcastEvent","CreateLiveBroadcastUIWaterfallTypedLogger","Link.react","LiveAPIPreviewPlayerBottomHelpText.react","LiveAPIPreviewPlayerSpinner.react","LiveAPIPreviewPlayerTopHelpText.react","LiveAPIStreamInputSelector.react","LiveVideoBroadcastActions","LiveVideoNoFlashError.react","LiveVideoPublisherToolsFunnelLogger","React","ReactComponentWithPureRenderMixin","ReactComposerContextTypes","ReactComposerLiveBroadcastPreviewActions","ReactComposerLiveBroadcastPreviewStore","ReactComposerLiveBroadcastStreamKeyFields.react","VideoComponentContextMenu.react","VideoComponentEmbeddedControls.react","VideoComponentLiveVideoIndicator.react","VideoComponentWithLiveBroadcast.react","VideoDataContainer.react","VideoPlayer.react","VideoPlayerLoggerSource","XUIText.react"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();a=b("React").PropTypes;var i="https://www.facebook.com/facebookmedia/get-started/live",j="https://www.facebook.com/help/587160588142067",k="https://www.facebook.com/help/587160588142067",l=5e3,m=465,n=285;c=b("React").createClass({displayName:"ReactComposerLiveBroadcastPreviewVideoPlayer",contextTypes:b("ReactComposerContextTypes"),mixins:[b("ReactComponentWithPureRenderMixin")],propTypes:{isUnifiedLiveUI:a.bool,accessToken:a.string,shown:a.bool.isRequired,streamURLs:a.object.isRequired,videoID:a.string.isRequired,composerType:a.string.isRequired,fluid:a.bool,isLive:a.bool,isPersistentStreamKeyOptionShown:a.bool,surpressLoadingState:a.bool,broadcastID:a.string,usePersistenStreamKeyByDefault:a.bool,selectedEncoderType:a.any,hasPairedEncoders:a.bool},getInitialState:function(){return{error:!1,isPlaying:!1,loading:!0,renderPlayer:!0,showPlayer:!1,timeoutID:null}},componentDidMount:function(){this.checkIfVideoIsPlaying()},checkIfVideoIsPlaying:function(){this.setState({timeoutID:setTimeout(function(){this.refs.player&&this.refs.player.isImplementationUnavailable&&this.setState({error:this.refs.player.isImplementationUnavailable()}),this.state.isPlaying?(this.resetAndShowPlayer(),b("LiveVideoPublisherToolsFunnelLogger").previewStarted()):(this.setState({loading:!1}),this.resetPlayer(),this.checkIfVideoIsPlaying())}.bind(this),l)})},resetAndShowPlayer:function(){this.setState({loading:!0}),this.resetPlayer(),this.setState({timeoutID:setTimeout(function(){this.setState({loading:!1,renderPlayer:!0,showPlayer:!0})}.bind(this),l)})},resetPlayer:function(){this.setState({renderPlayer:!1,showPlayer:!1})},_onUpdateMetadata:function(){this.state.isPlaying||this._logEvent(b("CreateBroadcastEvent").PREVIEW_START),this.setState({isPlaying:!0,loading:!0}),b("ReactComposerLiveBroadcastPreviewActions").setHasVideoStream(this.context.composerID,!0),b("LiveVideoBroadcastActions").apiBroadcastLivePreviewPlaying(!0)},_onFinishPlayback:function(){this.setState({isPlaying:!1,loading:!1}),b("ReactComposerLiveBroadcastPreviewActions").setHasVideoStream(this.context.composerID,!1),b("LiveVideoBroadcastActions").apiBroadcastLivePreviewPlaying(!1),this._logEvent(b("CreateBroadcastEvent").PREVIEW_END)},_getBroadcastID:function(){return this.props.broadcastID?this.props.broadcastID:b("ReactComposerLiveBroadcastPreviewStore").getBroadcastID(this.context.composerID)},_logEvent:function(a){new(b("CreateLiveBroadcastUIWaterfallTypedLogger"))().setEvent(a).setPageID(this.context.targetID).setBroadcastID(this._getBroadcastID()).setVideoID(this.props.videoID).setIsDraft(b("ReactComposerLiveBroadcastPreviewStore").isEditing(this.context.composerID)).log()},componentDidUpdate:function(){this.state.renderPlayer||this.setState({renderPlayer:!0})},componentWillUnmount:function(){this.state.timeoutID&&clearTimeout(this.state.timeoutID)},_handleVideoLoaded:function(){this.refs.player.vpc.addListener("finishPlayback",this._onFinishPlayback),this.refs.player.vpc.addListener("updateMetadata",this._onUpdateMetadata),this.setState({error:this.refs.player.vpc.isImplementationUnavailable()})},_renderVideoPlayer:function(){return!this.state.renderPlayer?null:this._renderReactVideoPlayer()},_renderReactVideoPlayer:function(){var a=this.props.isUnifiedLiveUI?null:b("React").createElement(b("VideoComponentLiveVideoIndicator.react"),{isLive:this.props.isLive?!0:undefined});return b("React").createElement("div",{className:(this.state.showPlayer?"":"_14e1")+(this.props.fluid?" _2clx":"")},b("React").createElement(b("VideoDataContainer.react"),{videoID:this.props.videoID,onVideoLoaded:function(){return this._handleVideoLoaded()}.bind(this)},b("React").createElement(b("VideoPlayer.react"),{className:"_14e2"+(this.props.fluid?" _2clx":"")+(this.props.fluid?"":" _2cly"),disableClickPlayPause:!0,keepPlayingOnDialog:!0,videoData:b("VideoDataContainer.react").VIDEO_DATA_PLACEHOLDER,width:this.props.fluid?undefined:m,height:this.props.fluid?undefined:n,subOrigin:b("VideoPlayerLoggerSource").LIVE_VIDEO_PREVIEW,autoplay:!0,ref:"player",startMuted:!0},b("React").createElement(b("VideoComponentEmbeddedControls.react"),{showFullscreenButton:!1,showSettingsButton:!0}),a,b("React").createElement(b("VideoComponentContextMenu.react"),null),b("React").createElement(b("VideoComponentWithLiveBroadcast.react"),null))))},_renderDefaultHelpText:function(){var a=i;this.props.isUnifiedLiveUI?a=k:this.props.composerType===b("ComposerEntryPointRef").LIVE_CONTROL_PANEL&&(a=j);return b("React").createElement(b("XUIText.react"),{display:"block",shade:"medium"},h._("If your video stream isn't working, make sure you copied the contents of these fields into your video streaming software's settings.")," ",b("React").createElement("span",null,b("React").createElement(b("Link.react"),{href:a,target:"_blank"},h._("Learn more")),"."))},render:function(){if(!this.props.shown)return b("React").createElement("div",null);var a=this.props.isUnifiedLiveUI?b("React").createElement(b("LiveAPIPreviewPlayerTopHelpText.react"),null):this._renderDefaultHelpText(),c=this.props.isUnifiedLiveUI?b("React").createElement(b("LiveAPIPreviewPlayerBottomHelpText.react"),null):null,d=this.props.isUnifiedLiveUI?b("React").createElement(b("LiveAPIStreamInputSelector.react"),{accessToken:this.props.accessToken,broadcastID:this._getBroadcastID(),hasPairedEncoders:!!this.props.hasPairedEncoders,usePersistenStreamKeyByDefault:this.props.usePersistenStreamKeyByDefault,selectedEncoderType:this.props.selectedEncoderType,streamURLs:this.props.streamURLs}):b("React").createElement(b("ReactComposerLiveBroadcastStreamKeyFields.react"),{isPersistentStreamKeyOptionShown:this.props.isPersistentStreamKeyOptionShown,broadcastID:this._getBroadcastID(),accessToken:this.props.accessToken,streamURLs:this.props.streamURLs}),e=this.props.isUnifiedLiveUI?null:b("React").createElement(b("CenteredContainer.react"),{horizontal:!0},b("React").createElement("div",{className:"_3k81"},b("React").createElement("div",{className:"_3k82"},h._("OFFLINE"))));e=b("React").createElement("div",{className:"_37bq"},e,b("React").createElement("div",{className:"_3-8j"},a,d,c));a=this.state.loading&&!this.props.surpressLoadingState?b("React").createElement(b("LiveAPIPreviewPlayerSpinner.react"),null):e;this.state.error&&(a=b("React").createElement(b("LiveVideoNoFlashError.react"),null));d=(this.props.fluid?"_2clz":"")+(this.props.fluid?"":" _14e3")+(this.props.isUnifiedLiveUI?" _h6n":"")+(this.props.isUnifiedLiveUI?"":" _h6p");c=this.props.fluid?"_2clx":"_2cly";return b("React").createElement(b("CenteredContainer.react"),{className:d,vertical:!0},b("React").createElement("div",{className:c},a,this._renderVideoPlayer()))}});e.exports=c}),null);