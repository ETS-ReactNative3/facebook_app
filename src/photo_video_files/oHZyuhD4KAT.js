if (self.CavalryLogger) { CavalryLogger.start_js(["f+cmw"]); }

__d("MessagingVideoViewer.react",["cx","fbt","ActorURI","ArbiterMixin","AsyncRequest","MessagingForwardingButtonNUX.react","PageTransitionsRegistrar","PhotoViewerDimensions","React","ReactFragment","SpotlightViewer","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","SpotlightViewerClose","SpotlightViewport","Vector","XMessagingVideoAttachmentController","guid"],(function(a,b,c,d,e,f,g,h){__p&&__p();a=b("React").PropTypes;var i=200;c=b("React").createClass({displayName:"MessagingVideoViewer",propTypes:{disableForward:a.bool,forwardDialogComponent:a.func.isRequired,pageID:a.number,rootClassName:a.string,videoSize:a.instanceOf(b("Vector")).isRequired,videoID:a.string.isRequired,videoURI:a.string.isRequired},mixins:[b("ArbiterMixin")],getInitialState:function(){var a=new(b("PhotoViewerDimensions"))({verticalPadding:i});return{dimensions:a.getStageDimensions(this.props.videoSize),loading:!0,open:!0,showForward:!1}},UNSAFE_componentWillMount:function(){this._domID=b("guid")()},componentDidMount:function(){this._loadVideoPlayer(),b("PageTransitionsRegistrar").registerCompletionCallback(function(){this.close();return!0}.bind(this))},_loadVideoPlayer:function(){var a=b("XMessagingVideoAttachmentController").getURIBuilder().setString("video_id",this.props.videoID).setString("video_container_id",this._domID).setInt("width",this.state.dimensions.x).setInt("height",this.state.dimensions.y).getURI();this.props.pageID&&(a=b("ActorURI").create(a,this.props.pageID));this.request=new(b("AsyncRequest"))().setMethod("GET").setURI(a).setReadOnly(!0).setHandler(function(a){return this.setState({loading:!1})}.bind(this)).send()},close:function(){if(!this.state.open)return;this.setState({open:!1},function(){this.inform("close")})},_showForwardDialog:function(){this.setState({showForward:!0}),this.refs.forwardNUX.close()},_hideForwardDialog:function(){this.setState({showForward:!1})},renderLayers:function(){if(this.props.disableForward)return null;var a=h._("Forward in separate messages"),c=this.props.forwardDialogComponent;return b("ReactFragment").create({forwardDialog:b("React").createElement(c,{attachmentID:this.props.videoID,onClose:this._hideForwardDialog,shown:this.state.showForward,title:a}),forwardButtonNUX:b("React").createElement(b("MessagingForwardingButtonNUX.react"),{contextRef:function(){return this.refs.forwardButton}.bind(this),ref:"forwardNUX"},h._("Send this video to other people in separate messages."))})},render:function(){var a=b("React").createElement("div",{className:"rfloat",id:this._domID}),c;this.props.disableForward||(c=b("React").createElement(b("SpotlightViewerBottomBarLink"),{onClick:this._showForwardDialog,ref:"forwardButton"},h._("Forward")));return b("React").createElement("span",null,b("React").createElement(b("SpotlightViewer"),{onHide:this.close,open:this.state.open,rootClassName:this.props.rootClassName},b("React").createElement(b("SpotlightViewport"),{active:!0,className:"_39hc",media:a,showLoadingIndicator:this.state.loading,stageDimensions:this.state.dimensions,useWidth:!0},b("React").createElement(b("SpotlightViewerClose"),{onClick:this.close}),b("React").createElement(b("SpotlightViewerBottomBar"),{className:"stat_elem"},b("React").createElement(b("SpotlightViewerBottomBarGroup"),null),b("React").createElement(b("SpotlightViewerBottomBarGroup"),null,c,b("React").createElement(b("SpotlightViewerBottomBarLink"),{s:"true",href:this.props.videoURI},h._("Download")))))),this.renderLayers())}});e.exports=c}),null);