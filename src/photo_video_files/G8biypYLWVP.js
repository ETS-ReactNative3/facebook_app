if (self.CavalryLogger) { CavalryLogger.start_js(["bTO\/N"]); }

__d("FBStoriesViewerCard.react",["ix","cx","fbt","CameraPostBucketOwnerHelper","CameraPostGraphQLAPI","CameraPostMediaHelper","CameraPostMuteButton.react","CameraPostOwnerView.react","CameraPostSendingToast.react","CameraPostSendReply.react","Event","FBStoriesActions","FBStoriesCardMedia.react","FBStoriesCardOptionsButton.react","FBStoriesCardWrappers.react","FBStoriesDeleteConfirmationDialog.react","FBStoriesLoggingHelper","FBStoriesMuteConfirmationDialog.react","FBStoriesOptimisticUploadLabel.react","FBStoriesViewersAnchor.react","FBStoryLiveSidePaneContainer.react","FBStoryThreadViewers.react","Image.react","Keys","Locale","React","SegmentedProgressBar.react","XUIButton.react","asset","createCancelableFunction","emptyFunction","getActiveElement","promiseDone"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k=b("FBStoriesCardWrappers.react").FBStoriesCard,l=b("FBStoriesCardWrappers.react").FBStoriesCardDialogs,m=b("FBStoriesCardWrappers.react").FBStoriesCardFooter,n=b("FBStoriesCardWrappers.react").FBStoriesCardHeader,o=b("FBStoriesCardWrappers.react").FBStoriesCardOverlays,p=.3,q=500,r=500,s=Object.freeze({NEXT:"next",PREV:"prev",STAY_HERE:"stay_here"}),t=1e3;c=babelHelpers.inherits(a,b("React").Component);j=c&&c.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=j.constructor).call.apply(a,[this].concat(e)),this.state={isDeleteConfirmationDialogShown:!1,isMuteConfirmationDialogShown:!1,isPaused:!1,isReplyFocused:!1,isShowingSendingToast:!1,isViewersPanelShown:!1,navDirectionOnClick:s.STAY_HERE,showPausedOverlay:!1,showStoryUI:!0},this.$49=function(){this.setState({isDeleteConfirmationDialogShown:!0})}.bind(this),this.$40=function(){this.setState({isDeleteConfirmationDialogShown:!1})}.bind(this),this.$39=function(){this.setState({isDeleteConfirmationDialogShown:!1}),this.$58()}.bind(this),this.$50=function(){this.setState({isMuteConfirmationDialogShown:!0})}.bind(this),this.$43=function(){this.setState({isMuteConfirmationDialogShown:!1})}.bind(this),this.$42=function(){this.setState({isMuteConfirmationDialogShown:!1}),this.props.onMuteBucketOwner()}.bind(this),this.$56=function(a){this.$10(),this.setState({isReplyFocused:!1})}.bind(this),this.$55=function(a){this.$38(!1,!0),this.setState({isReplyFocused:!0})}.bind(this),this.$29=function(event){this.$1=event.target}.bind(this),this.$35=function(a){if(this.state.isPaused)return;clearTimeout(this.$5);this.$5=setTimeout(function(){this.$38(!0,!1)}.bind(this),r)}.bind(this),this.$31=function(a){var c=a.currentTarget.offsetWidth;a=a.nativeEvent.offsetX;var d=p*c;b("Locale").isRTL()&&(a=c-a);a>=0&&a<=d?this.setState({navDirectionOnClick:s.PREV}):a>=c-d&&a<=c?this.setState({navDirectionOnClick:s.NEXT}):this.setState({navDirectionOnClick:s.STAY_HERE})}.bind(this),this.$36=function(a){__p&&__p();clearTimeout(this.$5);if(a.target.tagName==="INPUT")return;if(this.state.isPaused)this.$10(),this.state.isReplyFocused&&this.setState({isReplyFocused:!1});else{if(!this.props.enableNavigation)return;if(a.target.className!=="_ide")return;this.state.navDirectionOnClick===s.PREV?this.$46("tap_backward"):this.state.navDirectionOnClick===s.NEXT&&!this.state.isLastThread&&this.$45("tap_forward")}}.bind(this),this.$30=function(event){this.state.isPaused&&this.setState({showPausedOverlay:!0})}.bind(this),this.$15=function(a){a!==this.$8&&(a&&(b("Event").listen(a,"keydown",function(event){return this.$59(event)}.bind(this),b("Event").Priority.URGENT),b("Event").listen(a,"keyup",function(event){return this.$60(event)}.bind(this),b("Event").Priority.URGENT),a.focus())),this.$8=a}.bind(this),this.$12=b("createCancelableFunction")(function(){this.setState({isShowingSendingToast:!1})}.bind(this)),this.$54=function(a){__p&&__p();if(a!==""){var c=this.props.currentThreadData;if(!c||c.isLive)return;var d=c.threadID;c=c.cameraPostType;var e=this.props.userInfo.userID;this.$61();this.$10();this.setState({isReplyFocused:!1});b("promiseDone")(b("CameraPostGraphQLAPI").sendDirectMessageReply(e,d,a,c,!0))}}.bind(this),this.$11=b("createCancelableFunction")(function(a){this.setState({isShowingSendingToast:!0},function(){this.$9=setTimeout(function(){this.$9=undefined,this.$12()}.bind(this),a)}.bind(this))}.bind(this)),this.$53=function(){this.$6=!0,this.$38(!1,!1)}.bind(this),this.$52=function(){!this.$6&&!this.state.isReplyFocused&&!this.state.isViewersPanelShown&&this.$10(),this.$6=!1,this.$7=!1}.bind(this),this.$51=function(){this.$38(!1,!0),this.$7=!0}.bind(this),this.$34=function(){this.props.isBucketLive||this.$45("auto_jump")}.bind(this),this.$41=function(){var a=!this.state.isViewersPanelShown;this.setState({isViewersPanelShown:a});a&&b("FBStoriesLoggingHelper").openSeenSummaryLog();this.$7||(a?this.$38(!1,!0):this.$10())}.bind(this),c}a.prototype.componentDidMount=function(){b("FBStoriesLoggingHelper").openMediaLog()};a.prototype.componentDidUpdate=function(){var a=b("getActiveElement")();!this.state.isReplyFocused&&this.$8&&!this.props.isBucketLive&&(!this.$1||this.$1===a&&a.tagName!=="A"&&a.tagName!=="BUTTON")&&this.$8.focus()};a.prototype.componentWillUnmount=function(){this.$10(),this.$4&&this.$4.cancel(),this.$3&&this.$3.cancel(),this.$11.cancel(),this.$12.cancel()};a.prototype.UNSAFE_componentWillUpdate=function(a,c){!this.props.allBucketsViewed&&a.allBucketsViewed&&a.onDone(),this.props.bucketID!==a.bucketID?this.setState(this.$13()):this.props.currentThreadIndex!==a.currentThreadIndex&&this.$14(),a.currentThreadID!==this.props.currentThreadID&&(a.currentThreadID||a.isBucketLive)&&b("FBStoriesLoggingHelper").openMediaLog()};a.prototype.render=function(){var a="_4tkv"+(this.props.isLandscape&&this.props.isBucketLive?" _fxh":"")+" _24o3"+(this.props.isBucketLive?" _2dnb":"");if(!this.props.currentThreadData)return b("React").createElement("div",{role:"tabpanel",tabIndex:-1,ref:this.$15,className:a});a=this.$16();var c=this.$17(),d=this.$18(),e=this.$19(),f=this.$20(),g=this.$21(),h=this.$22(),i=this.$23(),j=this.$24(),p=this.$25(),q=this.$26(),r=this.props.isOwnThread?this.$27():this.$28();r=b("React").createElement("span",null,b("React").createElement(k,{componentBelowCard:r,isLandscape:this.props.isLandscape,isLive:this.props.isBucketLive,rootElemRef:this.$15,onFocus:this.$29,onMouseOut:this.$30,onMouseMove:this.$31,threadID:this.props.currentThreadID},b("React").createElement(b("React").Fragment,null,a,b("React").createElement(n,null,b("React").createElement(b("React").Fragment,null,c,d,e,f)),b("React").createElement(m,null,g),b("React").createElement(o,null,b("React").createElement(b("React").Fragment,null,h,i)),b("React").createElement(l,null,b("React").createElement(b("React").Fragment,null,j,p,q)))));if(this.props.isBucketLive)return this.$32(r);return this.props.isOwnThread?this.$33(r):r};a.prototype.$17=function(){__p&&__p();var a=this.props.currentThreadData;if(!a)return null;if(!a.isLive&&this.state.showStoryUI){var c=a.bucketOwner,d=a.cameraPostSource,e=a.cameraPostType,f=a.participants,g=a.threadOwner,h=a.time;a=a.originalPostStoryAttribution;var i=this.props.currentThreadID;return b("React").createElement(b("CameraPostOwnerView.react"),{bucketOwner:c,cameraPostSource:d,cameraPostType:e,participants:f,threadID:i,threadOwner:g,time:h,originalPostStoryAttribution:a})}return null};a.prototype.$16=function(){__p&&__p();var a=this.props.currentThreadData;if(!a)return null;var c=a.cameraPostType,d=a.media,e=this.props.currentThreadID,f=this.props.userInfo.userID,g;if(!a.isLive){var h=a.messageText;a=a.wwwTextFormatMetadata;g={rootMessageText:h||"",wwwTextFormatMetadata:a}}return b("React").createElement(b("React").Fragment,null,b("React").createElement(b("FBStoriesCardMedia.react"),{cameraPostType:c,isBucketLive:this.props.isBucketLive,isMediaMuted:this.props.isStoryMuted,media:d,onDone:this.$34,onMouseDown:this.$35,onMouseUp:this.$36,onTimeUpdate:this.$37,onVideoPaused:function(){this.state.isPaused||this.$38(!1,!0)}.bind(this),paused:this.state.isPaused,satpData:g,threadID:e,userID:f}))};a.prototype.$24=function(){var a=this.props.currentThreadData;if(!a)return null;a=a.media;a=b("CameraPostMediaHelper").getType(a);return b("React").createElement(b("FBStoriesDeleteConfirmationDialog.react"),{confirmAction:this.$39,hideAction:this.$40,mediaType:a,shown:this.state.isDeleteConfirmationDialogShown})};a.prototype.$21=function(){if(this.props.isStoryUploading)return b("React").createElement(b("FBStoriesOptimisticUploadLabel.react"),null);if(this.props.isThreadReviewStatusPending)return b("React").createElement("span",{className:"_449_"},i._("Pending Admin Approval"));return this.props.isOwnThread&&this.state.showStoryUI&&!this.props.isBucketLive?b("React").createElement(b("FBStoriesViewersAnchor.react"),{totalViewers:this.props.threadViewers.totalCount,highlighted:this.props.threadViewers.hasNewViewers,onClick:this.$41,disabled:!1,color:"light"}):null};a.prototype.$18=function(){var a=!this.props.isSelectedBucketLiveAndEnded;return!a||!this.state.showStoryUI?null:b("React").createElement(b("CameraPostMuteButton.react"),{muted:this.props.isStoryMuted,onMouseUp:this.props.onClickMute})};a.prototype.$25=function(){var a=this.props.currentThreadData;if(!a)return null;var c=a.bucketOwner;a=a.cameraPostType;c=b("CameraPostBucketOwnerHelper").getName(c);return b("React").createElement(b("FBStoriesMuteConfirmationDialog.react"),{bucketOwnerName:c,cameraPostType:a,confirmAction:this.$42,hideAction:this.$43,shown:this.state.isMuteConfirmationDialogShown})};a.prototype.$44=function(a){__p&&__p();if(!this.state.showStoryUI||this.state.showPausedOverlay)return null;if(!this.props.enableNavigation)return null;var c=this.props.allowedNavType==="PREV_ONLY"&&a===s.NEXT,d=this.props.allowedNavType==="NEXT_ONLY"&&a===s.PREV;if(d||c)return null;d=function(b){b.preventDefault(),b.stopPropagation(),this.$8.focus(),a===s.NEXT?this.$45("tap_forward"):this.$46("tap_backward")}.bind(this);c=function(b){b.stopPropagation(),this.setState({navDirectionOnClick:a})}.bind(this);return b("React").createElement("button",{"aria-label":a===s.NEXT?i._("Next Button"):a===s.PREV?i._("Previous Button"):i._("Button"),className:"_24o5"+(a===s.NEXT?" _24o8":"")+(a===s.PREV?" _24o7":"")+(this.state.navDirectionOnClick===a?" _24o6":""),onClick:d,onMouseMove:c,tabIndex:0})};a.prototype.$22=function(){var a=this.$44(s.PREV),c=this.$44(s.NEXT);return b("React").createElement(b("React").Fragment,null,a,c)};a.prototype.$19=function(){__p&&__p();var a=this.props.currentThreadData;if(!a)return null;if(!a.isLive&&this.state.showStoryUI){var c=a.bucketOwner,d=a.media;a=a.threadID;c=b("CameraPostBucketOwnerHelper").getName(c);d=b("CameraPostMediaHelper").getType(d);return b("React").createElement(b("FBStoriesCardOptionsButton.react"),{canMuteStoryOwner:this.$47(),isUserStory:this.$48(),isStoryUploading:this.props.isStoryUploading,mediaType:d,onClickDelete:this.$49,onClickMuteStoryOwner:this.$50,storyOwnerName:c,threadID:a,onPopoverShow:this.$51,onPopoverHide:this.$52,onPopoverItemClick:this.$53})}return null};a.prototype.$23=function(){return!this.state.showPausedOverlay?null:b("React").createElement("div",{className:"_ida"},b("React").createElement("span",{className:"_idd"}))};a.prototype.$20=function(){var a=this.props.currentThreadData;if(!a)return null;return a.isLive||!this.state.showStoryUI?null:b("React").createElement(b("SegmentedProgressBar.react"),{paused:this.state.isPaused,currentSegmentIndex:this.props.currentThreadIndex,currentSegmentPercentComplete:this.props.currentThreadPercentDone,segmentCount:this.props.threadsCount})};a.prototype.$27=function(){return b("React").createElement("div",{className:"_4wsa"},b("React").createElement(b("XUIButton.react"),{image:b("React").createElement(b("Image.react"),{src:g("492049")}),label:i._("Add to Your Storyaaaaa"),onClick:function(){this.props.onDone(),this.props.openComposerForProduction()}.bind(this)}))};a.prototype.$28=function(){if(this.props.shouldDisableReply)return null;var a=this.props.currentThreadData;if(!a)return null;a=a.cameraPostType;var c=this.props.currentThreadID,d=this.props.userInfo,e=d.userID,f=d.userName;d=d.userProfilePic;return b("React").createElement(b("CameraPostSendReply.react"),{cameraPostType:a,replyProfileName:f,replyProfilePic:d,userID:e,threadID:c,focused:this.state.isReplyFocused,onReplyEntered:this.$54,onFocusInput:this.$55,onBlurInput:this.$56})};a.prototype.$26=function(){return!this.state.isShowingSendingToast?null:b("React").createElement(b("CameraPostSendingToast.react"),null)};a.prototype.$57=function(){if(!this.state.isViewersPanelShown)return null;var a=this.props.currentThreadData;if(!a)return null;a=a.cameraPostType;return b("React").createElement("div",{className:"_397_"},b("React").createElement(b("FBStoryThreadViewers.react"),{cameraPostType:a,viewers:this.props.threadViewers}))};a.prototype.$32=function(a){return b("React").createElement("div",{className:"_272r"},a,b("React").createElement(b("FBStoryLiveSidePaneContainer.react"),{onDone:this.props.onDone}))};a.prototype.$33=function(a){var c=this.$57();return b("React").createElement("div",{className:"_272r"},c,a)};a.prototype.$48=function(){return this.props.isUserManagedThread};a.prototype.$58=function(){this.$38(!1,!1);b("FBStoriesLoggingHelper").deleteMediaLog();var a=this.props.currentThreadID,c=this.props.bucketID;a&&c&&this.$48()&&this.props.onDeleteCurrentThread();this.$10()};a.prototype.$59=function(event){__p&&__p();if(event.getModifiers().any||this.state.isReplyFocused||event.target!==this.$8||!this.props.enableNavigation)return!0;var a=b("Event").getKeyCode(event);switch(a){case b("Keys").LEFT:b("Locale").isRTL()?this.$45("tap_forward"):this.$46("tap_backward");return!1;case b("Keys").RIGHT:b("Locale").isRTL()?this.$46("tap_backward"):this.$45("tap_forward");return!1;default:a=String.fromCharCode(a);a.match(/\w/)&&this.setState({isReplyFocused:!0})}return null};a.prototype.$60=function(event){if(event.getModifiers().any||this.state.isReplyFocused||event.target!==this.$8)return!0;var a=b("Event").getKeyCode(event);switch(a){case b("Keys").SPACE:if(this.$7||this.state.isViewersPanelShown)return!1;!this.state.isPaused?this.$38(!1,!0):this.$10();return!1;default:return null}};a.prototype.$13=function(){return{isDeleteConfirmationDialogShown:!1,isMuteConfirmationDialogShown:!1,isPaused:!1,isReplyFocused:!1,isShowingSendingToast:!1,isViewersPanelShown:!1,navDirectionOnClick:s.STAY_HERE,showPausedOverlay:!1,showStoryUI:!0}};a.prototype.$14=function(){var a=this.props.currentThreadData;if(!a)return;this.setState({isPaused:!1,showPausedOverlay:!1,showStoryUI:!0})};a.prototype.$47=function(){return!this.props.isUserManagedBucket};a.prototype.$45=function(a){b("FBStoriesLoggingHelper").storyNavigationLog(a),this.props.onNextThread()};a.prototype.$46=function(a){b("FBStoriesLoggingHelper").storyNavigationLog(a),this.props.onPrevThread()};a.prototype.$38=function(a,b){this.setState({isPaused:!0,showStoryUI:!0,showPausedOverlay:b}),a&&(clearTimeout(this.$2),this.$2=setTimeout(function(){this.setState({showStoryUI:!1})}.bind(this),q))};a.prototype.$10=function(){clearTimeout(this.$5),clearTimeout(this.$2),this.setState({isPaused:!1,showPausedOverlay:!1,showStoryUI:!0,isViewersPanelShown:!1})};a.prototype.$61=function(){this.$11(t)};a.prototype.$37=function(a){b("FBStoriesActions").updateCurrentThreadPercentDone(a)};a.defaultProps={allowedNavType:"NEXT_ONLY",currentThreadPercentDone:0,enableNavigation:!0,isBucketLive:!1,isLandscape:!1,isSelectedBucketLiveAndEnded:!1,isStoryMuted:!1,isStoryUploading:!1,isThreadReviewStatusPending:!1,isUserManagedBucket:!1,isUserManagedThread:!1,onClickMute:b("emptyFunction"),onDeleteCurrentThread:b("emptyFunction"),onDone:b("emptyFunction"),onMuteBucketOwner:b("emptyFunction"),onNextThread:b("emptyFunction"),onPrevThread:b("emptyFunction"),openComposerForProduction:b("emptyFunction"),shouldDisableReply:!1};e.exports=a}),null);