if (self.CavalryLogger) { CavalryLogger.start_js(["NWvSh"]); }

__d("MercuryAttachmentPhotoGrid.react",["cx","ChatGridImage.react","Grid.react","MercuryAttachmentType","MercuryAttachmentViewer","MercuryIDs","MessagesViewerSetID","React","SpotlightMercurySharedMediaViewer.react","SphericalPhotoUtils","URI","getPageIDFromThreadID"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("Grid.react").GridItem,j=b("SphericalPhotoUtils").getThumbnailsFromPhotoEncodings;c=b("React").PropTypes;d=babelHelpers.inherits(a,b("React").Component);h=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=h.constructor).call.apply(a,[this].concat(e)),this.state={newSharedPhotosView:null},this.$1=function(a,c){var d=this.props.count,e=this.props.message;e=e.thread_fbid?e.thread_fbid:b("MercuryIDs").getThreadFBIDFromThreadID(e.thread_id);var f=new(b("URI"))("/ajax/messaging/attachments/sharedphotos.php").setQueryData({thread_id:e,image_id:a.metadata&&a.metadata.fbid}),g=b("MessagesViewerSetID").MESSAGES_VIEW_ALL_IN_THREAD;return function(e){b("MercuryAttachmentViewer").bootstrapWithConfig({dimensions:a.metadata.dimensions,disablePaging:c||d===1,endpoint:f,fbid:a.metadata.fbid,setID:g,src:a.preview_url},null)}}.bind(this),this.$2=function(a){a&&this.setState({newSharedPhotosView:a})}.bind(this),this.$3=function(){this.setState({newSharedPhotosView:null})}.bind(this),c}a.prototype.componentDidMount=function(){b("MercuryAttachmentViewer").preload()};a.prototype.$4=function(){var a=this.props.message.thread_fbid||this.props.message.thread_id&&b("MercuryIDs").getThreadFBIDFromThreadID(this.props.message.thread_id);return b("React").createElement(b("SpotlightMercurySharedMediaViewer.react"),{onClosePhotoView:this.$3,photoID:String(this.state.newSharedPhotosView),rootClassName:"",threadID:a,disableForward:!1})};a.prototype.render=function(){__p&&__p();var a=this.props.images,c=a.length;c=c==2||c==4?2:3;var d=Math.floor(this.props.size/c),e=[],f=a.some(function(a){return a.attach_type===b("MercuryAttachmentType").ANIMATED_IMAGE}),g=this.state.newSharedPhotosView?this.$4():null,h=!!b("getPageIDFromThreadID")(this.props.message.thread_id);for(var k=0;k<a.length;k++){var l=h?this.$1(a[k],f):this.$2,m=a[k].photo_encodings?a[k].photo_encodings.length!==0:!1,n=a[k].preview_url;if(m){var o=j(a[k].photo_encodings);o=o.smallThumbnail;n=o||n}e.push(b("React").createElement(i,{key:k},b("React").createElement(b("ChatGridImage.react"),{isLoading:!!a[k].preview_uploading,onClick:l,metadata:a[k].metadata,size:d,source:n,isSpherical:m})))}return b("React").createElement("div",null,g,b("React").createElement(b("Grid.react"),{cols:c,className:"_5b2w",spacing:"_5b2x",alignh:"right"},e))};a.propTypes={images:c.arrayOf(c.object).isRequired,size:c.number.isRequired,message:c.object.isRequired};e.exports=a}),null);